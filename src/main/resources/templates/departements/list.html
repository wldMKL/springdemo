<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Départements — Espace RH</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        :root {
            --bg: #0f0f10; --surface: #18181b; --surface-2: #1f1f23; --border: rgba(255,255,255,.07);
            --gold: #c8a96e; --gold-dim: #9c7d4d; --text: #f0ede8; --muted: #7a7470; --muted-2: #4a4643;
            --danger: #e05f5f; --success: #5fb88a; --radius: 14px; --tr: 260ms cubic-bezier(.4,0,.2,1);
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            min-height: 100vh; background-color: var(--bg);
            background-image: radial-gradient(ellipse 80% 60% at 70% 0%, rgba(200,169,110,.08) 0%, transparent 60%),
                              radial-gradient(ellipse 50% 40% at 10% 100%, rgba(200,169,110,.05) 0%, transparent 55%);
            font-family: 'DM Sans', 'Segoe UI', Arial, sans-serif; color: var(--text);
        }
        .topbar {
            background: rgba(15,15,16,.95); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border);
            padding: 0 2rem; height: 64px; display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 100;
        }
        .topbar-brand { display: flex; align-items: center; gap: .85rem; text-decoration: none; color: var(--text); }
        .monogram {
            width: 38px; height: 38px; background: linear-gradient(135deg, var(--gold), var(--gold-dim));
            border-radius: 9px; display: flex; align-items: center; justify-content: center;
            font-family: 'Cormorant Garamond', serif; font-size: 1.1rem; font-weight: 600; color: #111;
            box-shadow: 0 4px 12px rgba(200,169,110,.25);
        }
        .topbar-brand span { font-size: 1.05rem; font-weight: 500; letter-spacing: -.01em; }
        .topbar-right { display: flex; align-items: center; gap: 1.25rem; }
        .user-info { display: flex; align-items: center; gap: .6rem; font-size: .85rem; color: var(--muted); }
        .user-info i { font-size: 1.15rem; color: var(--gold-dim); }
        .user-info strong { color: var(--text); margin: 0 .4rem; }
        .badge {
            display: inline-block; font-size: .68rem; padding: .25em .65em; border-radius: 20px;
            text-transform: uppercase; font-weight: 500; letter-spacing: .05em;
        }
        .badge-admin { background: rgba(224,95,95,.12); color: #e07070; border: 1px solid rgba(224,95,95,.2); }
        .badge-emp { background: rgba(95,184,138,.12); color: #7ed4a8; border: 1px solid rgba(95,184,138,.2); }
        .btn-logout {
            padding: .6rem 1.1rem; background: transparent; border: 1px solid var(--border); border-radius: 8px;
            color: var(--muted); font-size: .82rem; cursor: pointer; display: flex; align-items: center; gap: .5rem;
            transition: all var(--tr);
        }
        .btn-logout:hover { border-color: rgba(224,95,95,.4); color: #e07070; background: rgba(224,95,95,.06); }
        .flash {
            max-width: 1200px; margin: 1.5rem auto; padding: 1rem 1.5rem; border-radius: 10px;
            display: flex; align-items: center; gap: .8rem;
        }
        .flash.success { background: rgba(95,184,138,.1); border: 1px solid rgba(95,184,138,.25); color: #7ed4a8; }
        .flash.error { background: rgba(224,95,95,.1); border: 1px solid rgba(224,95,95,.25); color: #e07070; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2.5rem 2rem; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .page-header h1 {
            font-family: 'Cormorant Garamond', serif; font-size: 2.5rem; font-weight: 300;
            color: var(--text); line-height: 1.2;
        }
        .page-header h1 span { color: var(--gold); }
        .page-header p { font-size: .95rem; color: var(--muted); margin-top: .5rem; }
        .btn {
            display: inline-flex; align-items: center; gap: .5rem; padding: .7rem 1.2rem; border-radius: 9px;
            font-size: .85rem; font-weight: 500; text-decoration: none; cursor: pointer; transition: all var(--tr);
            border: none;
        }
        .btn-primary { background: linear-gradient(135deg, var(--gold), var(--gold-dim)); color: #111; }
        .btn-primary:hover { opacity: .9; transform: translateY(-1px); box-shadow: 0 6px 20px rgba(200,169,110,.3); }
        .btn-secondary { background: transparent; border: 1px solid var(--border); color: var(--muted); }
        .btn-secondary:hover { border-color: var(--gold-dim); color: var(--gold); background: rgba(200,169,110,.08); }
        .dept-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 1.5rem; }
        .dept-card {
            background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 1.75rem;
            transition: transform var(--tr), box-shadow var(--tr);
        }
        .dept-card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,.3); }
        .dept-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 1rem; }
        .dept-info h3 { font-size: 1.2rem; font-weight: 500; color: var(--text); margin-bottom: .4rem; }
        .dept-info p { font-size: .85rem; color: var(--muted); line-height: 1.6; }
        .dept-actions { display: flex; gap: .4rem; }
        .btn-icon {
            width: 34px; height: 34px; border-radius: 8px; border: 1px solid var(--border); background: transparent;
            display: flex; align-items: center; justify-content: center; color: var(--muted); cursor: pointer;
            text-decoration: none; transition: all var(--tr);
        }
        .btn-icon:hover { border-color: var(--gold-dim); color: var(--gold); background: rgba(200,169,110,.08); }
        .btn-icon.danger:hover { border-color: rgba(224,95,95,.4); color: #e07070; background: rgba(224,95,95,.07); }
        .empty-state { text-align: center; padding: 4rem 2rem; color: var(--muted); }
        .empty-state i { font-size: 3rem; margin-bottom: 1rem; opacity: .5; }
        .empty-state h3 { font-size: 1.25rem; margin-bottom: .5rem; color: var(--text); }
        .empty-state p { font-size: .9rem; margin-bottom: 1.5rem; }
        @media (max-width: 768px) {
            .topbar { padding: 0 1.25rem; }
            .container { padding: 2rem 1.25rem; }
            .page-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .dept-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<nav class="topbar">
    <a class="topbar-brand" href="/dashboard">
        <div class="monogram">RH</div>
        <span>Espace RH</span>
    </a>
    <div class="topbar-right">
        <div class="user-info">
            <i class="bi bi-person-circle"></i>
            <strong sec:authentication="name">Utilisateur</strong>
            <span sec:authorize="hasRole('ADMIN')" class="badge badge-admin">Admin</span>
            <span sec:authorize="hasRole('EMPLOYE')" class="badge badge-emp">Employé</span>
        </div>
        <form th:action="@{/logout}" method="post" style="margin: 0;">
            <button type="submit" class="btn-logout">
                <i class="bi bi-box-arrow-right"></i> Déconnexion
            </button>
        </form>
    </div>
</nav>

<div th:if="${successMessage}" class="flash success">
    <i class="bi bi-check-circle-fill"></i>
    <span th:text="${successMessage}"></span>
</div>

<div th:if="${errorMessage}" class="flash error">
    <i class="bi bi-exclamation-triangle-fill"></i>
    <span th:text="${errorMessage}"></span>
</div>

<main class="container">
    <div class="page-header">
        <div>
            <h1>Gestion des <span>Départements</span></h1>
            <p>Organisez la structure de votre entreprise</p>
        </div>
        <div style="display: flex; gap: .75rem;">
            <a th:href="@{/dashboard}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Dashboard
            </a>
            <a th:href="@{/departements/add}" sec:authorize="hasRole('ADMIN')" class="btn btn-primary">
                <i class="bi bi-plus-lg"></i> Nouveau département
            </a>
        </div>
    </div>

    <div class="dept-grid" th:if="${departements != null and !departements.isEmpty()}">
        <div class="dept-card" th:each="dept : ${departements}">
            <div class="dept-header">
                <div class="dept-info">
                    <h3 th:text="${dept.nom}">Nom du département</h3>
                    <p th:text="${dept.description ?: 'Aucune description'}">Description</p>
                </div>
                <div class="dept-actions" sec:authorize="hasRole('ADMIN')">
                    <a th:href="@{/departements/edit(id=${dept.id})}" class="btn-icon" title="Modifier">
                        <i class="bi bi-pencil"></i>
                    </a>
                    <button type="button" class="btn-icon danger delete-btn" title="Supprimer"
                            th:attr="data-id=${dept.id},data-nom=${dept.nom}">
                        <i class="bi bi-trash3"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="empty-state" th:if="${departements == null or departements.isEmpty()}">
        <i class="bi bi-inbox"></i>
        <h3>Aucun département</h3>
        <p>Commencez par créer votre premier département.</p>
        <a th:href="@{/departements/add}" sec:authorize="hasRole('ADMIN')" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i> Créer un département
        </a>
    </div>
</main>

<script>
document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const id = this.getAttribute('data-id');
        const nom = this.getAttribute('data-nom');
        if (confirm('Supprimer le département « ' + nom + ' » ?\n\nATTENTION : Impossible si des employés y sont affectés.')) {
            window.location.href = '/departements/delete?id=' + id;
        }
    });
});
</script>

</body>
</html>